<!doctype html>
  <html>
    <head>
      <link rel="stylesheet" href="/term/dist/xterm.css" />
      <script src="/term/dist/xterm.js"></script>
      
    </head>
    <body>
      <div id="terminal"></div>
      
      <script src="/term/dist/xterm.js"></script>
      <script>
      	var term = new Terminal();
        term.open(document.getElementById('terminal'));
        term.write('\033[1;3;31mxterm.js\033[0m $ ');
        
        window.term = term;  // Expose `term` to window for debugging purposes

        term.on('resize', function (size) {
          if (!pid) {
            return;
          }
          var cols = size.cols,
              rows = size.rows,
              url = '/term/terminals/' + pid + '/size?cols=' + cols + '&rows=' + rows;

          fetch(url, {method: 'POST'});
        });

  var protocol = (location.protocol === 'https:') ? 'wss://' : 'ws://';
  var socketURL = protocol + location.hostname + ((location.port) ? (':' + location.port) : '') + '/term/terminals/';
  // term.open(terminalContainer);
  // term.fit();
  
  // fit is called within a setTimeout, cols and rows need this.
  setTimeout(function () {
      fetch('/term/terminals?cols=' + term.cols + '&rows=' + term.rows, {method: 'POST'})
      .then(function (res) {
        res.text().then(function (processId) {
        
            pid = processId;
            socketURL += processId;
            socket = new WebSocket(socketURL);
            socket.onopen = runRealTerminal;
            socket.onclose = runFakeTerminal;
            socket.onerror = runFakeTerminal;

            if (pid) {
              fit.fit(term);
              winptyCompatInit.winptyCompatInit(term);
            }
          });
        });
      }, 0);

      
     term.focus();

      // runRealTerminal()
      term.on('key', function (key, ev) 
      {
        var printable = (
          !ev.altKey && !ev.altGraphKey && !ev.ctrlKey && !ev.metaKey
        );

        if (ev.keyCode == 13) {
          term.prompt();
        } else if (ev.keyCode == 8) {
          // Do not delete the prompt
          if (term.x > 2) {
            term.write('\b \b');
          }
        } else if (printable) {
          term.write(key);
        }
      });

      term.on('paste', function (data, ev) {
        term.write(data);
      });
      
      // term.attach(socket);
      </script>
    </body>
  </html>
  